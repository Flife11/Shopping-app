<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

    function FormatDate(date)
    {
        const dateWithoutTimeZone = new Date(date);

        const year = dateWithoutTimeZone.getFullYear();
        const month = dateWithoutTimeZone.getMonth() + 1;
        const day = dateWithoutTimeZone.getDate();
        const hours = dateWithoutTimeZone.getHours();
        const minutes = dateWithoutTimeZone.getMinutes();
        const seconds = dateWithoutTimeZone.getSeconds();

        const formattedDateWithoutTimeZone = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        return formattedDateWithoutTimeZone;
    }
    window.onload = async function () {
        let data_order = [];
        var ngayHienTai = new Date();
        var ngayChiTiet = FormatDate(ngayHienTai);
        ngayHienTai.setDate(1); // Đặt ngày là 1 để lấy ngày đầu tiên của tháng

       var ngayDauTienCuaThang = FormatDate(ngayHienTai); 
        const dataPost={
            from:ngayDauTienCuaThang,
            to:ngayChiTiet
        }
        const orders = await fetch('/admin/getOrders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body:JSON.stringify(dataPost)
        })
        let rs_order = await orders.json();
        // insert order if fetch success
        if (orders.ok) {
            data_order = rs_order;
            {{!-- console.log(data_order); --}}
            // Create label and data for pieChart
            var lineLabels = data_order.lineLabels;
            var lineData = data_order.lineData;
           
            // Draw a line chart  depicting revenue 
            const lineChart = document.getElementById('lineChart');
            new Chart(lineChart, {
                type: 'line',

                data: {
                    labels: lineLabels,
                    datasets: [{
                        label: `Doanh Thu`,
                        data: lineData,
                        borderWidth: 1,

                    }]
                },
                options:
                {
                    responsive: true,
                }
            });
        }
        var listCategory = [];
        // Lấy data category từ server Main
        let rs = await fetch('/admin/getCategory', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body:JSON.stringify(dataPost)

        })
        let rsData = await rs.json();
        // insert order if fetch success
        if (rs.ok) {
            listCategory = rsData;
            // Create label and data for pieChart
            var pieLabels = rsData.pieLabels;
            var pieData = rsData.pieData;
            // Draw a pie chart depicting the type of product purchased
            const pieChart = document.getElementById('pieChart');
            new Chart(pieChart, {
                type: 'doughnut',
                data: {
                    labels: pieLabels,
                    datasets: [{
                        label: 'Số lượng bán',
                        data: pieData,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true

                }
            });
        }
    };

</script>